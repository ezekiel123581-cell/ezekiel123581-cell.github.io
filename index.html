<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>김은석 · Workspace</title>
<meta name="description" content="개인 포트폴리오 & 워크스페이스" />

<!-- ===================== STYLES (정리/재배치) ===================== -->
<style>
/* =========================================================
   0) THEME VARIABLES
   ========================================================= */
:root{
  --card:#ffffff;
  --text:#e6edf6;
  --muted:#9fb0c5;
  --accent:#7cc4ff;
  --accent2:#00e0b8;
}

/* =========================================================
   1) RESET / BASE
   ========================================================= */
*{ box-sizing:border-box; margin:0; padding:0; }
html,body{ height:100%; }
body{
  font:16px/1.6 system-ui, Segoe UI, Roboto, "Apple SD Gothic Neo","Noto Sans KR", sans-serif;
  color:var(--text);
  min-height:100%;
  padding:24px 24px 24px 260px; /* 사이드바 폭 + 여백 */
}

/* 배경 캔버스 */
.bg{
  position:fixed;
  inset:0;
  z-index:-1;
  display:block;
  width:100%;
  height:100%;
  background:#000; /* 로딩 중 임시색 */
}

/* =========================================================
   2) LAYOUT
   ========================================================= */
.sidebar{
  position:fixed; top:0; left:0; height:100%; width:236px;
  background:rgba(0,0,0,.35);
  backdrop-filter:blur(8px);
  border-right:1px solid rgba(255,255,255,.1);
  padding:28px 18px;
  z-index:10;
}
.sidebar h2{ font-size:20px; margin-bottom:14px; }
.cats{ display:flex; flex-direction:column; gap:8px; }

.canvas{
  max-width:1280px; margin:0 auto;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  border-radius:22px;
  padding:22px;
  box-shadow:0 12px 40px rgba(0,0,0,.25);
}

.columns{
  display:grid; gap:22px;
  grid-template-columns:58% 42%;
}

/* =========================================================
   3) COMPONENTS
   ========================================================= */
.cat{
  display:block; width:100%;
  color:#fff; background:transparent;
  border:1px solid rgba(255,255,255,.25);
  padding:10px 12px; border-radius:10px; font-weight:800;
  text-align:left; cursor:pointer;
  transition:background .15s ease, border-color .15s ease, color .15s ease;
}
.cat:hover{ background:rgba(255,255,255,.08); }
.cat.active{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#001018; border-color:transparent;
}

.workspace .head{
  display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;
}
.workspace .head h3{ margin:0; font-size:20px; }
.grid{
  display:grid; gap:14px;
  grid-template-columns:repeat(2,minmax(0,1fr));
}

/* 카드 (썸네일 레이아웃) */
/* 🔻 썸네일 */
.cardlet{
  display:block; text-decoration:none;
  background:#fff; color:#0b1220;
  border:1px solid rgba(0,0,0,.08);
  border-radius:14px; overflow:hidden; /* 썸네일 라운드 */
  min-height:150px;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
  transition:transform .15s ease, box-shadow .15s ease;
}
.cardlet:hover{ transform:translateY(-2px); box-shadow:0 12px 28px rgba(0,0,0,.16); }

.cardlet__thumb{
  position:relative;
  width:100%; aspect-ratio:16/9; /* 일정한 비율로 썸네일 */
  background:linear-gradient(135deg,#e2e8f0,#cbd5e1);
  overflow:hidden;
}
.cardlet__thumb img{
  width:100%; height:100%; object-fit:cover; display:block;
}

.cardlet__body{
  padding:14px 16px;
}
.cardlet__title{ margin:0 0 6px; font-size:18px; font-weight:700; }
.cardlet__desc{ margin:0; color:#475569; font-size:14px; }

/* 썸네일 플레이스홀더(이미지 없을 때) */
.thumb-fallback{
  position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
  font-weight:800; font-size:18px; color:#0b1220;
  background:linear-gradient(135deg,#dbeafe,#bcf0da);
}

/* 안내(빈 상태) */
.empty{
  opacity:.7; text-align:center;
  padding:30px 10px;
  border:1px dashed #cbd5e1;
  border-radius:14px;
  background:rgba(255,255,255,.6);
}

/* 블록 */
.block{
  background:#fff; color:#0b1220;
  border:1px solid rgba(0,0,0,.08);
  border-radius:18px; padding:22px;
  box-shadow:0 10px 28px rgba(0,0,0,.15);
}
.block h3{ margin:0 0 10px; font-size:22px; }
.intro{ min-height:160px; }
.desc{ min-height:200px; }

/* 푸터 */
footer{ margin-top:14px; text-align:center; color:var(--muted); }

/* 상태 */
.workspace-only .columns{ grid-template-columns:1fr; }
.workspace-only .left{ display:none; }

/* 반응형 */
@media (max-width:980px){
  .columns{ grid-template-columns:1fr; }
}
@media (max-width:640px){
  body{ padding:16px; }
  .sidebar{
    position:static; width:auto; height:auto;
    border-right:none;
    border:1px solid rgba(255,255,255,.12);
    border-radius:16px;
    margin-bottom:12px;
  }
  .canvas{ padding:16px; }
}

/* 배경음악 컨트롤 */
.audioctl{
  margin-top:14px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.audioctl .vol{
  display:flex;
  align-items:center;
  gap:8px;
  color:#e5e7eb;
  font-size:12px;
}
.audioctl input[type="range"]{
  width:100%;
  accent-color: var(--accent);
}
</style>
</head>
<body>

<!-- 배경: 깃발 일렁임 -->
<canvas id="bgCanvas" class="bg"></canvas>

<!-- 사이드바 -->
<aside class="sidebar">
  <h2>카테고리</h2>
  <div class="cats">
    <button class="cat active" data-cat="전체">전체</button>
    <button class="cat" data-cat="게임">게임</button>
    <button class="cat" data-cat="그림">그림</button>
    <button class="cat" data-cat="기타">기타</button>
  </div>

  <!-- 배경음악 컨트롤 -->
  <div class="audioctl">
    <button id="music-toggle" class="cat" type="button">🎵 배경음악 재생</button>
    <div class="vol">
      <label for="music-vol">볼륨</label>
      <input id="music-vol" type="range" min="0" max="1" step="0.01" value="0.4" />
    </div>
    <div class="vol" style="margin-top:4px">
   <label for="music-track">트랙</label>
   <select id="music-track"></select>
</div>

  </div>
</aside>

<!-- 메인 -->
<div class="canvas">
  <div class="columns">
    <div class="left">
      <section class="block intro">
        <h3>자기소개</h3>
        <p>AI · 3D · GPT 실험을 기록하는 김은석입니다.<br>
           카테고리를 클릭하면 오른쪽에 해당 작업물만 표시됩니다.</p>
      </section>

      <section class="block desc" style="margin-top:14px">
        <h3>설명</h3>
        <p>카테고리를 바꿔도 페이지는 이동하지 않고
           오른쪽 카드 목록만 바뀝니다.</p>
      </section>
    </div>

    <div class="right workspace">
      <div class="head">
        <h3 id="ws-title">workspace · 전체</h3>
        <small style="color:#cbd5e1">카드를 클릭하면 새 탭으로 이동</small>
      </div>
      <div id="grid" class="grid"></div>
    </div>
  </div>
  <footer>© 2025 Eunseok Kim</footer>
</div>

<!-- ===================== SCRIPTS ===================== -->
<script>
/* ===== Waving Background (padding-only fix for top/bottom exposure) ===== */
(function(){
  const canvas = document.getElementById('bgCanvas');
  const ctx = canvas.getContext('2d', { alpha: true });
  ctx.imageSmoothingEnabled = true;

  const IMG_URL = 'https://ezekiel123581-cell.github.io/bg4.png'; // 루트에 bg4.png 가정
  const img = new Image();
  img.crossOrigin = 'anonymous';
  img.src = IMG_URL;

  let vw=0, vh=0, offscreen, octx;

  // Wave params
  const amplitude  = 9;       // 흔들림 크기
  const wavelength = 200;     // 파장
  const speed      = 0.3;     // 속도
  const tilt       = 0.25;    // x 진행 위상 가중치
  const PADDING    = Math.ceil(amplitude * 1.25) + 2; // 상/하 노출 방지

  function resize(){
    vw = canvas.width  = window.innerWidth;
    vh = canvas.height = window.innerHeight;

    offscreen = document.createElement('canvas');
    offscreen.width  = vw;
    offscreen.height = vh + 2*PADDING;
    octx = offscreen.getContext('2d');

    drawBaseImage();
  }

  function drawBaseImage(){
    if(!img.complete) return;

    const iw = img.naturalWidth, ih = img.naturalHeight;
    const r  = Math.max(vw/iw, vh/ih); // cover
    const dw = iw * r, dh = ih * r;
    const dx = (vw - dw) * 0.5;
    const dy = (vh - dh) * 0.5;

    octx.clearRect(0,0,offscreen.width,offscreen.height);
    // 패딩만큼 아래로 이동해 원본 배치
    octx.drawImage(img, dx, dy + PADDING, dw, dh);
    // 위/아래 가장자리 1px을 패딩으로 확장(클램핑)
    octx.drawImage(offscreen, 0, PADDING, vw, 1,              0, 0,             vw, PADDING);
    octx.drawImage(offscreen, 0, vh + PADDING - 1, vw, 1,     0, vh + PADDING,  vw, PADDING);
  }

  let t0=0;
  function animate(ts){
    if(!t0) t0 = ts;
    const time = (ts - t0) / 1000;

    ctx.clearRect(0,0,vw,vh);

    const SLICE_W = 2;
    for(let x=0; x<vw; x+=SLICE_W){
      const progress = x / vw;
      const localAmp = amplitude * (0.4 + 0.6*progress);
      const yOffset  = Math.sin((x + time*speed*180) / wavelength * (Math.PI*2) + progress*tilt) * localAmp;

      ctx.drawImage(
        offscreen,
        x, 0, SLICE_W, vh + 2*PADDING,         // src
        x, yOffset - PADDING, SLICE_W, vh + 2*PADDING  // dst
      );
    }
    requestAnimationFrame(animate);
  }

  img.onload = () => { resize(); requestAnimationFrame(animate); };
  window.addEventListener('resize', () => { resize(); drawBaseImage(); });
})();

/* ===== Items & Category Filter (with thumbnails) ===== */
/* 썸네일 경로는 실제 저장 위치로 맞춰주세요. */
const items = [
  {
    title:'GitHub',
    desc:'소스와 저장소',
    href:'https://github.com/ezekiel123581-cell',
    cat:'기타',
    thumb:'https://ezekiel123581-cell.github.io/images/img5.png'   // GitHub → img 5
  },
  {
    title:'시각예술시뮬레이터',
    desc:'시각 실험 데모',
    href:'./simulator.html',
    cat:'그림',
    thumb:'https://ezekiel123581-cell.github.io/images/img3.png'   // 시각 → img 3
  },
  {
    title:'GPT · 지구 칵테일',
    desc:'나만의 GPT – 지구 칵테일',
    href:'https://chatgpt.com/g/g-68b834ee2d4c8191b9ce84960a9aeda8-jigu-kagteil',
    cat:'기타',
    thumb:'https://ezekiel123581-cell.github.io/images/img2.png'   // 지구 칵테일 → img 2
  },
  {
    title:'GPT · 요리 레시피를 알려주는 쥐',
    desc:'나만의 GPT – 요리 도우미',
    href:'https://chatgpt.com/g/g-68b81a61f75c8191a19abbbe0d553797-yoriresipireul-alryeojuneun-jwi',
    cat:'기타',
    thumb:'https://ezekiel123581-cell.github.io/images/img1.png'   // 쥐 → img 1
  },
  {
    title:'게임 프로토타입(준비중)',
    desc:'추가 예정',
    href:'#',
    cat:'게임',
    disabled:true,
    thumb:'https://ezekiel123581-cell.github.io/images/img6.png'   // 프로토 → img 6
  },
  {
    title:'드로잉 · Grim',
    desc:'캔버스 드로잉 데모',
    href:'./Grim.html',
    cat:'그림',
    thumb:'https://ezekiel123581-cell.github.io/images/img4.png'   // 드로잉 → img 4
  }
];


const grid  = document.getElementById('grid');
const title = document.getElementById('ws-title');

function makePlaceholder(text=''){
  // 카드 제목 이니셜 2자 정도 추출
  const t = text.trim().replace(/^GPT\s*·\s*/i,'');
  const initials = Array.from(t).filter(ch=>/\p{L}/u.test(ch)).slice(0,2).join('').toUpperCase() || 'WS';
  const div = document.createElement('div');
  div.className = 'thumb-fallback';
  div.textContent = initials;
  return div;
}

function render(category='전체'){
  grid.innerHTML='';
  const filtered = category==='전체' ? items : items.filter(it=>it.cat===category);

  if(filtered.length===0){
    grid.innerHTML = `<div class="empty">이 카테고리에 표시할 작업이 없습니다.</div>`;
    return;
  }

  filtered.forEach(it=>{
    const a = document.createElement('a');
    a.className = 'cardlet';

    // 썸네일 영역
    const thumbWrap = document.createElement('div');
    thumbWrap.className = 'cardlet__thumb';

    if (it.thumb){
      const img = document.createElement('img');
      img.loading = 'lazy';
      img.decoding = 'async';
      img.alt = `${it.title} 미리보기`;
      img.src = it.thumb;
      // 이미지 로드 에러 시 플레이스홀더로 대체
      img.addEventListener('error', ()=>{
        thumbWrap.innerHTML = '';
        thumbWrap.appendChild(makePlaceholder(it.title));
      });
      thumbWrap.appendChild(img);
    } else {
      thumbWrap.appendChild(makePlaceholder(it.title));
    }

    // 텍스트 영역
    const body = document.createElement('div');
    body.className = 'cardlet__body';
    body.innerHTML = `<h4 class="cardlet__title">${it.title}</h4><p class="cardlet__desc">${it.desc}</p>`;

    // 상태/링크
    if(it.disabled){
      a.href = 'javascript:void(0)';
      a.style.opacity = .6;
      a.style.pointerEvents = 'none';
    } else {
      a.href = it.href;
      a.target = '_blank';
      a.rel = 'noopener';
    }

    // 조립
    a.appendChild(thumbWrap);
    a.appendChild(body);
    grid.appendChild(a);
  });

  title.textContent = `workspace · ${category}`;
}
render('전체');
// 초기엔 소개 보이도록 유지
document.body.classList.remove('workspace-only');

document.querySelectorAll('.cat').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.cat').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');

    const cat = btn.dataset.cat;
    render(cat);

    // '전체'는 소개 보이고, 나머지는 워크스페이스만
    if (cat === '전체') {
      document.body.classList.remove('workspace-only');
    } else {
      document.body.classList.add('workspace-only');
    }
  });
});

/* ===== Background Music ===== */
/* ===== Background Music: Playlist (Repeat-All) ===== */
const AUDIO_BASE = 'https://ezekiel123581-cell.github.io/audio/'; // <- 네 오디오 폴더 URL로 수정

const FILENAMES = [
  'Untitled (1).mp3',
  'Untitled.mp3',
  '君の中にある赤い線と青い線 (1).mp3',
  '君の中にある赤い線と青い線.mp3',
  '君の中にある赤い線と青い線 (3).mp3',
  '君の中にある赤い線と青い線 (2).mp3',
  'The red line and blue line within you.mp3',
  'The red line and blue line within you (1).mp3'
];

const PLAYLIST = FILENAMES.map(name => ({
  title: name.replace(/\.mp3$/i, ''),
  src: encodeURI(AUDIO_BASE + name)
}));

let currentIndex = Math.min(
  Math.max(parseInt(localStorage.getItem('bgmIndex') ?? '0', 10) || 0, 0),
  PLAYLIST.length - 1
);

const savedVol = parseFloat(localStorage.getItem('bgmVol') ?? '0.4');
const savedOn  = localStorage.getItem('bgmOn') === '1';

const bgm = new Audio(PLAYLIST[currentIndex].src);
bgm.loop = false;          // 한 곡 반복 X (플레이리스트 반복으로 처리)
bgm.preload = 'auto';
bgm.volume = Number.isFinite(savedVol) ? savedVol : 0.4;

const $toggle = document.getElementById('music-toggle');
const $vol    = document.getElementById('music-vol');
const $track  = document.getElementById('music-track');

if ($vol) $vol.value = String(bgm.volume);
if ($track){
  $track.innerHTML = PLAYLIST.map((t, i)=> `<option value="${i}">${t.title}</option>`).join('');
  $track.value = String(currentIndex);
}

function fadeTo(target = 1, ms = 500){
  const steps = 24, dt = ms / steps;
  const start = bgm.volume;
  let i = 0;
  const timer = setInterval(()=>{
    i++;
    bgm.volume = Math.min(1, Math.max(0, start + (target - start) * (i/steps)));
    if (i >= steps) clearInterval(timer);
  }, dt);
}

async function setTrack(index, { autoplay = false } = {}){
  currentIndex = (index + PLAYLIST.length) % PLAYLIST.length; // 순환
  localStorage.setItem('bgmIndex', String(currentIndex));

  const keepVolume = bgm.volume;
  const wasPlaying = autoplay || !bgm.paused;

  try { bgm.pause(); } catch(_) {}
  bgm.src = PLAYLIST[currentIndex].src + '?v=' + Date.now(); // 캐시 회피
  bgm.currentTime = 0;
  bgm.volume = keepVolume;

  if ($track) $track.value = String(currentIndex);

  if (wasPlaying) {
    try {
      await bgm.play();
      fadeTo(keepVolume, 300);
      if ($toggle) $toggle.textContent = '⏸ 배경음악 일시정지';
    } catch(e) {
      console.warn(e);
    }
  }
}

function nextTrack(){ setTrack(currentIndex + 1, { autoplay: !bgm.paused }); }
function prevTrack(){ setTrack(currentIndex - 1, { autoplay: !bgm.paused }); }

bgm.addEventListener('ended', nextTrack);  // 한 곡 끝나면 다음 곡 → 끝나면 처음으로

async function playBgm(){
  try{
    if (bgm.currentTime === 0) { await bgm.play().catch(()=>{}); bgm.pause(); }
    await bgm.play();
    fadeTo(parseFloat($vol?.value ?? '0.4'), 300);
    if ($toggle) $toggle.textContent = '⏸ 배경음악 일시정지';
    localStorage.setItem('bgmOn','1');
  }catch(e){
    console.warn('Autoplay blocked:', e);
  }
}
function pauseBgm(){
  fadeTo(0, 250);
  setTimeout(()=>bgm.pause(), 260);
  if ($toggle) $toggle.textContent = '🎵 배경음악 재생';
  localStorage.setItem('bgmOn','0');
}

$toggle?.addEventListener('click', ()=> (bgm.paused ? playBgm() : pauseBgm()) );
$vol?.addEventListener('input', (e)=>{
  const v = parseFloat(e.target.value);
  bgm.volume = v;
  localStorage.setItem('bgmVol', String(v));
});
$track?.addEventListener('change', (e)=>{
  const i = parseInt(e.target.value, 10) || 0;
  setTrack(i, { autoplay: !bgm.paused });
});

let wasPlaying = false;
document.addEventListener('visibilitychange', ()=>{
  if (document.hidden){
    wasPlaying = !bgm.paused;
    if (wasPlaying) pauseBgm();
  } else {
    if (wasPlaying) playBgm();
  }
});

if (savedOn){
  const unlock = () => {
    if (bgm.paused) playBgm();
    window.removeEventListener('pointerdown', unlock, { once:true });
    window.removeEventListener('keydown',  unlock, { once:true });
  };
  window.addEventListener('pointerdown', unlock, { once:true });
  window.addEventListener('keydown',  unlock, { once:true });
  if ($toggle) $toggle.textContent = '⏸ 배경음악 일시정지';
}

</script>
</body>
</html>

  title.textContent = `workspace · ${category}`;
}
render('전체');
// 초기엔 소개 보이도록 유지
document.body.classList.remove('workspace-only');

document.querySelectorAll('.cat').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.cat').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');

    const cat = btn.dataset.cat;
    render(cat);

    // '전체'는 소개 보이고, 나머지는 워크스페이스만
    if (cat === '전체') {
      document.body.classList.remove('workspace-only');
    } else {
      document.body.classList.add('workspace-only');
    }
  });
});
</script>
</body>
</html>
